<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>帽子社区</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" type="text/css" href="../static/layui/css/layui.css" />
<!--    <script src="//www.layuicdn.com/layui-v2.5.5/layui.js"></script>-->
    <script src="../static/layui/layui.js"></script>
    <!--    <link rel="stylesheet" type="text/css" href="  https://www.layuicdn.com/layui-v2.5.5/css/layui.css" />-->
</head>
<body>
<div id="top"></div>
<div class="layui-fluid" style="max-width:1170px">
    <div class="layui-col-xs12 layui-col-md8">

            <div class="layui-card" >
                <div id="demo"   class="grid-demo grid-demo-bg1"></div>
            </div>


    </div>



    <div class="layui-col-xs12 layui-col-md4 ">
        <div id="right"   class="layui-card"></div>
    </div>
</div>



<script>
    layui.use(['util','flow','layer'], function(){
        var layer=layui.layer;
        var $ = layui.jquery;
        $("#top").load("./top.html");
        $("#right").load("./right.html");
        var flow = layui.flow;
        var id = layui.router().search.note;
        // var util = layui.util;
        flow.load({
            elem: '#demo' //指定列表容器
            ,isAuto: false
            ,   end: '<p >我是有底线的</p>'
            ,isLazyimg: true
            ,done: function(page, next){ //到达临界点（默认滚动触发），触发下一页
                var lis = [];
                //以jQuery的Ajax请求为例，请求下一页数据（注意：page是从2开始返回）
                $.get('/api/index/details?note='+id, function(res){
                    //假设你的列表返回在data集合中
                    layui.each(res.data, function(index, item){
                        // lis.push('' +
                        //     '  <li><a href="#"> <li class="layui-badge">'+ item.found +
                        //     '<li>'+ item.id +'</li>' +
                        //     '<li>'+ item.time +'</li>' +
                        //     '<li>'+ item.room +'</li>' +
                        //     '<li>'+ item.contact +'</li></a>'
                        // );
                        lis.push('' +
                            '                <div class="layui-card-header layui-field-title"><h2>'+ item.title +'</h2><span class="layui-badge layui-layout-right">'+item.type+'</span></div>' +
                            '                <div class="layui-card-body ">'                + item.main +''+
                            ' <br>'+item.time+' <div class="layui-col-md7 layui-col-xs6"> &nbsp; </div>     <a  id="zq_login"><button type="button" class="layui-btn layui-btn-normal ">删除</button></a></div>'


                            // ' <div class="layui-col-md12 "><div class="layui-card"><div class="layui-card-header"><li class="layui-badge">'+ item.type +'</li>'+ item.title +'</div><div class="layui-card-body">'+ item.main +' </div>  </div> </div><hr class="layui-bg-gray">'
                        );

                    });

                    //执行下一页渲染，第二参数为：满足“加载更多”的条件，即后面仍有分页
                    //pages为Ajax返回的总页数，只有当前页小于总页数的情况下，才会继续出现加载更多
                    next(lis.join(''), page < res.count);
                });
            }
        });

        $(document).on('click','#zq_login',function() {
            layer.prompt({ value:'发帖时填入的学号',title: '请输入学号',},function(val, index){

                var id = layui.router().search.note;
                // layer.msg('得到了'+val);
                layer.msg('加载中', {
                    icon: 16
                    ,shade: 0.01
                });

                $.get('/api/index/dele?id='+id+'&sno='+val, function(data) {

                    if(data.status) {
                        // obj.del();
                        layer.msg(data.data);
                    }else {
                        layer.alert(data.data, function(){
                            layer.closeAll();

                        }); }
                }, 'json');

            });

        })
    });
</script>

</body>
</html>